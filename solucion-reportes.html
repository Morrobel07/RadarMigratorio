<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üîß Soluci√≥n Directa - Reportes</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 2rem;
        background: #f5f5f5;
        text-align: center;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      button {
        background: #28a745;
        color: white;
        padding: 1rem 2rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1.1rem;
        margin: 1rem;
      }
      button:hover {
        background: #218838;
      }
      .btn-admin {
        background: #007bff;
      }
      .btn-admin:hover {
        background: #0056b3;
      }
      .result {
        margin: 1rem 0;
        padding: 1rem;
        border-radius: 4px;
        background: #d4edda;
        color: #155724;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Soluci√≥n Directa para Reportes</h1>
      <p>Esta p√°gina solucionar√° el problema de los reportes que no se cargan en el admin.</p>

      <button onclick="solucionarReportes()">üõ†Ô∏è SOLUCIONAR REPORTES AHORA</button>
      <button onclick="irAlAdmin()" class="btn-admin">üë®‚Äçüíº IR AL PANEL ADMIN</button>

      <div id="resultado"></div>
    </div>

    <script src="assets/js/dataManager.js"></script>
    <script>
      function solucionarReportes() {
        const resultado = document.getElementById('resultado')
        resultado.innerHTML = '<p>üîÑ Solucionando problema de reportes...</p>'

        try {
          // 1. Inicializar DataManager
          const dataManager = new DataManager()
          console.log('‚úÖ DataManager inicializado')

          // 2. Limpiar reportes previos problem√°ticos
          localStorage.removeItem('radarMigratorio_reportes')
          console.log('üóëÔ∏è Reportes previos limpiados')

          // 3. Crear reportes de prueba directamente en localStorage
          const reportesPrueba = [
            {
              id: 'REP-000001',
              tipo: 'documentos-falsos',
              descripcion: 'Persona vendiendo documentos falsos en el centro de la ciudad',
              ubicacion: 'Parque Central, Santo Domingo',
              fecha_incidente: '2025-08-10T14:30:00.000Z',
              personas_involucradas: 'Hombre de 40 a√±os aproximadamente',
              evidencia: 'Fotos y testigos',
              prioridad: 'alta',
              nombre_reportante: 'Juan P√©rez',
              telefono_reportante: '809-555-0123',
              email_reportante: 'juan@email.com',
              fecha_reporte: '2025-08-10T15:00:00.000Z',
              estado: 'pendiente',
              ip_reportante: '192.168.1.100',
              navegador: 'Chrome',
            },
            {
              id: 'REP-000002',
              tipo: 'trabajo-irregular',
              descripcion: 'Empresa con trabajadores sin permisos de trabajo',
              ubicacion: 'Zona Industrial, Santo Domingo',
              fecha_incidente: '2025-08-09T08:00:00.000Z',
              personas_involucradas: '15-20 trabajadores',
              evidencia: 'Videos documentando la situaci√≥n',
              prioridad: 'media',
              fecha_reporte: '2025-08-09T18:30:00.000Z',
              estado: 'en_revision',
              ip_reportante: '192.168.1.101',
              navegador: 'Safari',
            },
            {
              id: 'REP-000003',
              tipo: 'trafico-personas',
              descripcion: 'URGENTE: Gritos de auxilio desde casa abandonada',
              ubicacion: 'Coordenadas: 18.4861, -69.9312',
              fecha_incidente: '2025-08-11T22:00:00.000Z',
              personas_involucradas: 'Voces de mujeres pidiendo ayuda',
              evidencia: 'Grabaci√≥n de audio',
              prioridad: 'urgente',
              nombre_reportante: 'Mar√≠a Gonz√°lez',
              telefono_reportante: '809-555-0456',
              fecha_reporte: '2025-08-11T22:15:00.000Z',
              estado: 'en_investigacion',
              ip_reportante: '192.168.1.102',
              navegador: 'Firefox',
            },
          ]

          // 4. Guardar directamente en localStorage
          localStorage.setItem('radarMigratorio_reportes', JSON.stringify(reportesPrueba))
          console.log('üíæ Reportes guardados directamente en localStorage')

          // 5. Verificar que se guardaron correctamente
          const reportesVerificacion = JSON.parse(
            localStorage.getItem('radarMigratorio_reportes') || '[]'
          )
          console.log('üîç Verificaci√≥n: reportes guardados:', reportesVerificacion.length)

          // 6. Actualizar estad√≠sticas
          const estadisticas = JSON.parse(
            localStorage.getItem('radarMigratorio_estadisticas') || '{}'
          )
          estadisticas.totalReportes = reportesVerificacion.length
          estadisticas.reportesPendientes = reportesVerificacion.filter(
            (r) => r.estado === 'pendiente'
          ).length
          localStorage.setItem('radarMigratorio_estadisticas', JSON.stringify(estadisticas))

          resultado.innerHTML = `
                    <div class="result">
                        <h3>‚úÖ ¬°PROBLEMA SOLUCIONADO!</h3>
                        <p>Se han creado <strong>${reportesVerificacion.length} reportes de prueba</strong></p>
                        <p>Los reportes ahora deber√≠an aparecer en el panel administrativo.</p>
                        <p><strong>Pr√≥ximo paso:</strong> Ve al panel de administraci√≥n</p>
                    </div>
                `

          console.log('üéâ Soluci√≥n completada exitosamente')
        } catch (error) {
          console.error('‚ùå Error durante la soluci√≥n:', error)
          resultado.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 4px;">
                        <h3>‚ùå Error durante la soluci√≥n</h3>
                        <p>Error: ${error.message}</p>
                        <p>Revisa la consola del navegador para m√°s detalles.</p>
                    </div>
                `
        }
      }

      function irAlAdmin() {
        window.location.href = 'admin/admin-login.html'
      }

      // Mostrar estado actual al cargar
      window.onload = () => {
        const reportesExistentes = localStorage.getItem('radarMigratorio_reportes')
        if (reportesExistentes) {
          const reportes = JSON.parse(reportesExistentes)
          document.getElementById('resultado').innerHTML = `
                    <div style="background: #cce5ff; color: #0066cc; padding: 1rem; border-radius: 4px;">
                        <p>üìä Estado actual: ${reportes.length} reportes en el sistema</p>
                        <p>Si los reportes no aparecen en el admin, haz clic en "SOLUCIONAR REPORTES AHORA"</p>
                    </div>
                `
        }
      }
    </script>
  </body>
</html>
